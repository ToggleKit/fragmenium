(async()=>{window.cleanup=async()=>{old_v_page||(old_v_page=window.location.pathname),n(),i(),await s(),await p(),await r(),await d(),await l(),await w(),window.scrollTo({top:0,behavior:"smooth"})};const t=await import("./reference.js").then((t=>t.ref)),e=document.createRange(),o=document.body;let a;function n(){if(!t?.css?.common)return;let e=new f(window.location.pathname).directory_path();""===e&&(e="/");const o=t.css.common[e];window.active_dir!==e&&(document.head.querySelectorAll('link[data-type="common"]').forEach((t=>t.remove())),window.active_dir=e,o&&o.forEach((t=>c(t,"common"))))}function i(){if(!t?.css?.specifics)return;document.head.querySelectorAll('link[data-type="specific"]').forEach((t=>t.remove()));const e=t.css.specifics[window.location.pathname];e&&e.forEach((t=>c(t,"specific")))}function c(t,o){document.head.appendChild(e.createContextualFragment(`<link data-type="${o}" rel="stylesheet" href="${t}">`))}async function s(o){if(t.unique){const o=window.location.pathname,a=await m(o);if(!a){const e=t.error_page?t.error_page:"/404.html";return history.replaceState({},"",e),void s()}const n=await e.createContextualFragment(a),i=t.unique.map((async t=>{const e=document.querySelector(t),a=n.querySelector(t);await h(a),e?a?e.replaceWith(a):console.log(`"${t}" does not exist in ${o}`):console.log(`"${t}" does not exist in ${old_v_page}`)}));await Promise.all(i)}}async function r(){if(t.common){let a=new f(window.location.pathname).directory_path();""===a&&(a="/");const n=t.common.map((async t=>{let n;if(t.except&&(n=t.except[a]),n){if(window[t.selector]==a)return;window[t.selector]=a}else{if("default"==window[t.selector])return;window[t.selector]="default",n=t.default}const i=o.querySelector(t.selector);if(i)try{const o=await m(n),a=e.createContextualFragment(o).querySelector(t.selector);await h(a),i.replaceWith(a)}catch(e){console.error(`Error fetching or injecting ${t.path}:`,e)}else console.log(`"${t.selector}" does not exist on this page`)}));await Promise.all(n)}}async function l(){if(!t?.js?.common)return;let e=new f(window.location.pathname).directory_path();""==e&&(e="/");const o=t.js.common[e];window.active_js_dir&&window.active_js_dir!==e?u("#common_js"):window.active_js_dir&&window.active_js_dir==e?(u("#common_js"),await _(t.js.common[e],"common_js",e)):o&&window.active_js_dir!==e&&(window.active_js_dir=e,await _(t.js.common[e],"common_js",e))}async function w(){if(!t?.js?.specific)return;u("#specific_js");const e=window.location.pathname,o=t.js.specific[e];o&&await _(o,"specific_js")}async function d(){t?.js?.every&&(u("#every_js"),await _(t.js.every,"every_js"))}async function p(){if(t.constant){const a=t.constant.map((async t=>{const a=`constant_html_default_${t.selector}`,n=window.location.pathname,i=`default_constant_${t.selector}_polluted`;let c;if(t.except?.[n])c=await m(t.except[n]),window[i]=!0;else switch(window[i]){case void 0:window[i]=!1,c=await m(t.path),window[a]=c;break;case!0:c=window[a],c||(c=await m(t.path));break;case!1:return}const s=(await e.createContextualFragment(c)).querySelector(t.selector);if(!s)return void console.error(`Constant selector "${t.selector}" is missing in constant path "${t.path}"`);await h(s);const r=o.querySelector(t.selector);r?r.replaceWith(s):alert(`<${t.selector}> element not find!`)}));await Promise.all(a)}}async function h(o){if(!t.swap)return;const a=Object.entries(t.swap).map((async([t,a])=>{const n=o.querySelectorAll(t);for(const t of n)if(t){let o;window["swap_text_"+a]?o=window["swap_text_"+a]:(o=await m(a),window["swap_text_"+a]=o);const n=o.match(/\${(.*?)}/g);if(n)for(let e of n){const a=t.getAttribute(e.match(/\$\{([^}]+)\}/)?.[1])??"";o=o.replace(e,a)}const i=e.createContextualFragment(o);t.replaceWith(i)}}));await Promise.all(a)}async function m(t){if(""!==t&&" "!==t){const e=await fetch(t).then((t=>t.text()));return e||!1}console.log(`path is not valid in "referencs.js": ${t}`)}function u(t){document.querySelector(t)?.remove()}function f(t){this.path=t,this.extention=()=>this.path.split(".").pop(),this.file=()=>this.path.split("/").pop(),this.directory_path=()=>{const t=this.path.split("/");return t.pop(),t.join("/")},this.directorys=()=>{const t=this.path.split("/");return t.shift(),t.pop(),t}}async function _(t,e,n){if("common_js"===e){if(n===window.active_js_dir&&a)return c(a);window.active_js_dir=n}const i=await Promise.all(t.map((async t=>`\n //start ${t}\n${await m(t)}\n//end ${t}\n`)));function c(t){const a=`(async()=>{ with(top.window){ ${t.join("\n")} } })();`,n=document.createElement("iframe");n.style.display="none",n.id=e,o.appendChild(n),n.contentDocument.body.appendChild(n.contentDocument.createRange().createContextualFragment(`<script>${a}<\/script>`))}"common_js"===e&&(a=i),c(i)}t.swap&&h(o),t?.css?.constant&&t.css.constant.forEach((t=>{c(t,"constant")})),n(),i(),await p(),await r(),await async function(){if(t?.js?.constant)for(const e of t.js.constant)try{await import(e)}catch(t){console.log(`issue with: ${e}\n${t}`)}}(),await d(),await l(),await w(),old_v_page=window.location.pathname,window.addEventListener("popstate",cleanup),o.addEventListener("click",(async t=>{if("A"==t.target.tagName&&!t.target.getAttribute("target")||t.target.closest("a:not([target])"))if(t.preventDefault(),t.target.hash||t.target.closest("a").hash){const e=t.target.hash?document.querySelector(t.target.hash):document.querySelector(t.target.closest("a").hash);if(!e)return;history.replaceState(null,"",t.target.hash),e.scrollIntoView({behavior:"smooth"})}else{let e="A"==t.target.tagName?t.target.href:t.target.closest("a:not([target])").href;history.pushState({},"",e),await cleanup()}}))})();